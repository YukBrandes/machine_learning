# 关联式规则（AR）

Author：Yuk / 稻粱谋

Date：2016-08-20

---
关联式规则(Association Rules, AR)，又称关联规则，是数据挖掘的一个重要课题，用于从大量数据中挖掘出有价值的数据项之间的相关关系。关联规则解决的常见问题如：“如果一个消费者购买了产品A，那么他有多大机会购买产品B?”以及“如果他购买了产品C和D，那么他还将购买什么产品？”正如大多数数据挖掘技术一样，关联规则的任务在于减少潜在的大量杂乱无章的数据，使之成为少量的易于观察理解的静态资料。关联式规则多不考虑项目的次序，而仅考虑其组合。

关联规则一个经典的实例是购物篮分析(Market Basket Analysis)。超市对顾客的购买记录数据库进行关联规则挖掘，可以发现顾客的购买习惯，例如，购买产品X的同时也购买产品Y，于是，超市就可以调整货架的布局，比如将X产品和Y产品放在一起，增进销量。

应用领域：
> 癌症数据：分析DNA与蛋白质的模式
> 信用欺诈：与购物、医疗津贴的模式
> 行为分析：套餐升级、购物、退订等

## 1 Apriori 算法

忽略罕见组合，利用关于频繁项集性质的一个简单的先验概念：一个频繁项集的所有子集必须也是频繁的。

**Sample：**
如果{A,B}是频繁的，那么{A},{B}是频繁的。

### 1.1 支持度（Support）

支持度是指在所有项集中{X, Y}出现的可能性，即项集中同时含有X和Y的概率：

该指标作为建立强关联规则的第一个门槛，衡量了所考察关联规则在“量”上的多少。通过设定最小阈值（minsup），剔除“出镜率”较低的无意义规则，保留出现较为频繁的项集所隐含的规则,频繁模式(Frequent Patten)。

**Sample：**
> A　　E　　F　　G

> A　　F　　G

> A　　B　　E　　F　　G

> E　　F　　G

上例中一共有4个事务。

{A,F,G}的支持数为3，支持度为3/4。

{F,G}的支持度数为4，支持度为4/4。

{A}的支持度数为3，支持度为3/4。

### 1.2 置信度（Confidence）

置信度表示在先决条件X发生的条件下，关联结果Y发生的概率：

这是生成强关联规则的第二个门槛，衡量了所考察的关联规则在“质”上的可靠性。相似的，我们需要对置信度设定最小阈值（mincon）来实现进一步筛选。

**Sample：**
> A　　E　　F　　G

> A　　F　　G

> A　　B　　E　　F　　G

> E　　F　　G

{F,G}=>{A}的置信度为：{A,F,G}的支持度数 除以 {F,G}的支持度数，即3/4

{A}=>{F,G}的置信度为：{A,F,G}的支持度数 除以 {A}的支持度数，即3/3


### 1.3 提升度（lift）

提升度表示在含有X的条件下同时含有Y的可能性与没有X这个条件下项集中含有Y的可能性之比，该指标与置信度同样衡量规则的可靠性，可以看作是置信度的一种互补指标。

### 1.4 算法步骤

> 1. 项集元素从1至N多次迭代，选出满足支持度最小阈值的所有项集，即频繁项集。

> 2. 从频繁项集中找出满足最小置信度的所有规则。

### 1.5 算法评价
**优点：**简单、易理解、数据要求低，

**缺点：**
> 1. 在每一步产生侯选项目集时循环产生的组合过多，没有排除不应该参与组合的元素

> 2. 每次计算项集的支持度时，都对数据库D中的全部记录进行了一遍扫描比较，如果是一个大型的数据库的话，这种扫描比较会大大增加计算机系统的I/O开销。

### 1.6 R案例
```

```

## 2 F-P算法
FP-Growth 算法(Frequent Pattern-growth),是一种不产生候选模式而采用频繁模式增长的方法挖掘频繁模式的算法。

算法只需要扫描2次数据库：

第一次扫描数据库，得到1维频繁项集；

第二次扫描数据库，利用1维频繁项集过滤数据库中的非频繁项，同时生成FP树。由于FP树蕴涵了所有的频繁项集，其后的频繁项集的挖掘只需要在FP树上进行。

FP树挖掘由两个阶段组成：

第一阶段建立FP树，即将数据库中的事务构造成一棵FP树；

第二阶段为挖掘FP树，即针对FP树挖掘频繁模式和关联规则。
**Sample：**



## 3 Eclat 算法
Eclat算法加入了倒排的思想，加快频繁集生成速度。其算法思想是将事务数据中的项作为key，每个项对应的事务ID作为value，由频繁k项集求交集，生成候选k+1项集 。对候选k+1项集做裁剪，生成频繁k+1项集，再求交集生成候选k+2项集。如此迭代，直到项集归一。

### 3.1 算法步骤
> 1. 一次扫描数据库，获得初始数据。包括频繁1项集，数据库包含的所有items，事务总数（行）transNum，最小支持度minsup=limitValue*trans。

> 2. 二次扫描数据库，获得频繁2项集。

> 3. 按照Eclat算法，对频繁2项集迭代求交集，做裁剪，直到项集归一。

### 3.2 R的案例

## 参考链接
> 1. [维基百科：关联式规则](https://zh.wikipedia.org/wiki/%E5%85%B3%E8%81%94%E5%BC%8F%E8%A7%84%E5%88%99)

> 2. [用R语言进行购物篮分析(关联规则)](http://www.idatacamp.com/2015/09/09/%E7%94%A8r%E8%AF%AD%E8%A8%80%E8%BF%9B%E8%A1%8C%E8%B4%AD%E7%89%A9%E7%AF%AE%E5%88%86%E6%9E%90%EF%BC%88%E5%85%B3%E8%81%94%E8%A7%84%E5%88%99%EF%BC%89/)

> 3. [FP-Tree算法的实现](http://www.cnblogs.com/zhangchaoyang/articles/2198946.html)